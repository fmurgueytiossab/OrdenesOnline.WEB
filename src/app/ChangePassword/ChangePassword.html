<div class="page-container">
  <mat-card class="login-card">

    <mat-card-title>Cambiar contraseña</mat-card-title>

    <mat-card-content>

      <!-- Loading: no mostrar nada hasta validar token -->
      <ng-container *ngIf="!loading">

        <!-- Token inválido -->
        <ng-container *ngIf="tokenInvalido">
          <p class="helper-text">
            El enlace ha expirado o es inválido. Debes solicitar un nuevo enlace para restablecer tu contraseña.
          </p>
          <mat-card-actions class="actions-row" *ngIf="tokenInvalido">
  <button
    mat-raised-button
    color="primary"
    class="primary-button"
    (click)="volverLogin()">
    Solicitar nuevo enlace
  </button>
</mat-card-actions>
        </ng-container>

        <!-- Mensaje de éxito -->
        <ng-container *ngIf="cambioExitoso">
          <p class="success-message">{{ mensaje }}</p>
          <div class="actions-row" style="justify-content: center;">
            <button mat-raised-button color="primary" (click)="volverLogin()" class="primary-button">
              Volver al login
            </button>
          </div>
        </ng-container>

        <!-- Formulario solo si token válido y no se ha cambiado -->
        <ng-container *ngIf="!tokenInvalido && !cambioExitoso">

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Correo electrónico</mat-label>
            <input matInput type="email" [(ngModel)]="correo" readonly>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nueva contraseña</mat-label>
            <input matInput type="password" [(ngModel)]="password" required>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Confirmar contraseña</mat-label>
            <input matInput type="password" [(ngModel)]="confirmPassword" required>
          </mat-form-field>

        </ng-container>

      </ng-container>

    </mat-card-content>

    <!-- Acciones -->
    <mat-card-actions class="actions-row">

      <!-- Botón de cambiar contraseña -->
      <button
        mat-raised-button
        color="primary"
        (click)="cambiarPassword()"
        [disabled]="cambioExitoso"
        *ngIf="!tokenInvalido && !cambioExitoso">
       Cambiar contraseña
      </button>

    </mat-card-actions>

  </mat-card>
</div>
